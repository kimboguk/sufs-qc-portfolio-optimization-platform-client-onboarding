# 온보딩 완전 재설계 완료 - 조건부 질문 동적 표시 (13단계)

## 🎯 설계 목표

**조건부 질문을 같은 화면에서 동적으로 표시**하여 UX 개선 및 단계 축소

---

## ✅ 완료 사항

### 📊 단계 축소
- **Before**: 19단계 (조건부 질문마다 별도 단계)
- **After**: **13단계** (조건부 질문은 같은 화면에 동적 표시)

### 📄 수정된 파일
1. **OnboardingForm.tsx** - 완전 재작성
2. **onboardingStore.ts** - totalSteps: 19 → 13

### ✅ 유지된 파일
- **constants.ts** - 변경 없음
- **onboarding.ts** - 변경 없음
- **Button.tsx, Select.tsx** - 변경 없음

---

## 📋 새로운 13단계 구조

### Step 1: 사업 분야
- 금융 / 마케팅 선택

### Step 2: 자산 수
- 50개 미만 ~ 2,000개 초과

### Step 3: 파생상품 여부 ✨
- **메인 질문**: 파생상품이 포함되어 있습니까?
- **조건부 (예 선택 시)**: ↓ 같은 화면에 표시
  - 파생상품을 최적화에 포함시키시겠습니까?

### Step 4: 거래 비용 포함
- 예 / 아니요

### Step 5: 최적화 수행 기간
- 단일 기간 / 다중 기간

### Step 6: 제약 조건 (복수선택)
- 10가지 제약 조건 체크박스

### Step 7: 규제 제약 여부 ✨
- **메인 질문**: 규제 제약이 있습니까?
- **조건부 (예 선택 시)**: ↓ 같은 화면에 표시
  - 규제 내용 입력 (textarea)

### Step 8: 최적화 프레임워크
- 8가지 프레임워크 중 선택

### Step 9: 포트폴리오 관리 전략 ✨
- **메인 질문**: 선호하는 전략이 있습니까?
- **조건부 (예 선택 시)**: ↓ 같은 화면에 표시
  - 전략 선택 (Buy & Hold, 1/N, 퀸타일, 전역 최대)
  - **중첩 조건부 (퀸타일 선택 시)**: ↓ 더 아래에 표시
    - 순위 산정 기준 입력

### Step 10: 신규 자산 추가 ✨
- **메인 질문**: 새로운 자산을 추가하시겠습니까?
- **조건부 (예 선택 시)**: ↓ 같은 화면에 표시
  - 추가할 자산 입력 (textarea)

### Step 11: 서비스 플랜
- 3가지 플랜 중 선택

### Step 12: 리밸런싱 ✨
- **메인 질문**: 리밸런싱하시겠습니까?
- **조건부 (예 선택 시)**: ↓ 같은 화면에 표시
  - 리밸런싱 방식 (자동/수동/반자동)

### Step 13: 포트폴리오 건전성 확인
- 예 / 아니요

---

## 🎨 UI/UX 개선 사항

### 1. 동적 화면 표시
```
┌─────────────────────────────────────┐
│ 규제 제약이 있습니까?                │
│ ○ 예  ○ 아니요                      │
├─────────────────────────────────────┤  ← border-t-2 구분선
│ 규제 내용을 입력해주세요            │
│ ┌─────────────────────────────────┐ │
│ │ [텍스트 입력 영역]              │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 2. 시각적 구분
- 조건부 질문은 **회색 구분선**으로 구분
- 메인 질문과 조건부 질문 간 **8px 여백**
- 부드러운 애니메이션 효과 (transition)

### 3. Validation 개선
- 메인 질문과 조건부 질문 **모두 검증**
- 조건부 입력값 비어있으면 **명확한 에러 메시지**
- trim() 처리로 공백만 입력된 경우도 검증

---

## 🔧 주요 코드 변경

### 조건부 렌더링 패턴

**Before (기존 - 별도 단계):**
```typescript
case 8:
  return <규제 여부 질문>
case 9:
  return <규제 내용 입력>  // 별도 단계
```

**After (개선 - 같은 단계):**
```typescript
case 7:
  return (
    <>
      <규제 여부 질문>
      
      {formData.hasRegulationConstraints === true && (
        <div className="mt-8 pt-8 border-t-2">
          <규제 내용 입력>
        </div>
      )}
    </>
  )
```

### Validation 로직

**Before:**
```typescript
case 8:
  if (!formData.hasRegulationConstraints) return false
  return true
case 9:
  if (!formData.regulationDetails) return false
  return true
```

**After:**
```typescript
case 7:
  if (!formData.hasRegulationConstraints) return false
  // 조건부 validation
  if (formData.hasRegulationConstraints === true) {
    if (!formData.regulationDetails?.trim()) return false
  }
  return true
```

---

## 🚀 효과 및 장점

### 1. 단계 축소
- **19단계 → 13단계** (6단계 감소, 31% 단축)
- 사용자가 체감하는 온보딩 길이 대폭 감소

### 2. UX 개선
- ✅ **즉각적인 피드백**: 선택하면 바로 관련 질문 표시
- ✅ **문맥 유지**: 관련 질문이 같은 화면에 있어 이해 쉬움
- ✅ **불필요한 클릭 감소**: "다음" 버튼 클릭 횟수 감소

### 3. 개발 관점
- ✅ **유지보수 용이**: 관련 로직이 한 곳에 모여있음
- ✅ **명확한 조건부 흐름**: if문으로 조건 명확히 표현
- ✅ **확장 용이**: 새로운 조건부 질문 추가 쉬움

---

## 📂 파일 위치

```
/mnt/user-data/outputs/
├── OnboardingForm.tsx          (완전 재작성)
└── onboardingStore.ts          (totalSteps 수정)
```

---

## 🔄 적용 방법

```bash
# 1. OnboardingForm.tsx 교체
cp OnboardingForm.tsx src/components/onboarding/

# 2. onboardingStore.ts 교체
cp onboardingStore.ts src/store/

# 3. 개발 서버 재시작
npm run dev
```

---

## ✅ 검증 체크리스트

### Step 3: 파생상품
- [ ] "아니요" 선택 → 조건부 질문 숨김
- [ ] "예" 선택 → 아래에 "최적화 포함?" 표시
- [ ] "최적화 포함?" 선택 안 하면 다음 버튼 에러

### Step 7: 규제 제약
- [ ] "아니요" 선택 → 조건부 질문 숨김
- [ ] "예" 선택 → 아래에 텍스트 입력 표시
- [ ] 텍스트 비어있으면 다음 버튼 에러
- [ ] 공백만 입력하면 에러

### Step 9: 포트폴리오 전략
- [ ] "아니요" 선택 → 조건부 질문 숨김
- [ ] "예" 선택 → 아래에 전략 선택 표시
- [ ] 퀸타일 선택 → 더 아래에 순위 기준 입력 표시
- [ ] 다른 전략 선택 → 순위 기준 숨김

### Step 10: 신규 자산
- [ ] "아니요" 선택 → 조건부 질문 숨김
- [ ] "예" 선택 → 아래에 자산 입력 표시
- [ ] 자산 비어있으면 에러

### Step 12: 리밸런싱
- [ ] "아니요" 선택 → 조건부 질문 숨김
- [ ] "예" 선택 → 아래에 방식 선택 표시
- [ ] 방식 선택 안 하면 에러

### 전체 흐름
- [ ] Step 1 → 13까지 모두 정상 작동
- [ ] 진행률 표시 정확 (13단계 기준)
- [ ] 이전 버튼으로 돌아가도 입력값 유지
- [ ] 마지막 단계에서 "완료" 버튼 표시

---

## 🎉 완성!

**조건부 질문을 같은 화면에서 동적으로 표시**하는 깔끔하고 직관적인 온보딩 폼이 완성되었습니다!

- ✅ 19단계 → 13단계로 대폭 축소
- ✅ 조건부 질문 같은 화면에 표시
- ✅ 명확한 validation
- ✅ 개선된 UX

---

**작성일**: 2025년 10월 28일  
**버전**: 3.0 (완전 재설계)
